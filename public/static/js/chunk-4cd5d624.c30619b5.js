(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4cd5d624"],{"0bd5":function(e,t,n){},"190b":function(e,t,n){n("149f")&&"g"!=/./g.flags&&n("064e").f(RegExp.prototype,"flags",{configurable:!0,get:n("f1fe")})},"232a":function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n("df3b");function r(e){if(Array.isArray(e))return Object(a["a"])(e)}var i=n("b5eb"),o=n("db29");function c(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(e){return r(e)||Object(i["a"])(e)||Object(o["a"])(e)||c()}},"2b45":function(e,t,n){"use strict";n("190b");var a=n("69b3"),r=n("f1fe"),i=n("149f"),o="toString",c=/./[o],s=function(e){n("bf16")(RegExp.prototype,o,e,!0)};n("238a")((function(){return"/a/b"!=c.call({source:"a",flags:"b"})}))?s((function(){var e=a(this);return"/".concat(e.source,"/","flags"in e?e.flags:!i&&e instanceof RegExp?r.call(e):void 0)})):c.name!=o&&s((function(){return c.call(this)}))},"866b":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"remote1",attrs:{"element-loading-text":e.loadingText,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"}},[e.isJoin?e._e():n("div",{staticClass:"shade"},[n("div",{staticClass:"input-container"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.account,expression:"account"}],attrs:{type:"text",placeholder:"请输入你的昵称"},domProps:{value:e.account},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.join(t)},input:function(t){t.target.composing||(e.account=t.target.value)}}}),n("button",{on:{click:e.join}},[e._v("确定")])])]),n("div",{staticClass:"userList"},[n("h5",[e._v("在线用户："+e._s(e.userList.length))]),e._l(e.userList,(function(t){return n("p",{key:t.account},[e._v("\n            "+e._s(t.account)+"\n            "),t.account===e.account||t.account===e.isCall?n("i",[e._v("\n                "+e._s(t.account===e.account?"me":"")+"\n                "+e._s(t.account===e.isCall?"calling":"")+"\n            ")]):e._e(),t.account!==e.account&&t.account!==e.isCall?n("span",{on:{click:function(n){return e.apply(t.account)}}},[e._v("呼叫 "+e._s(t.account))]):e._e()])}))],2),n("div",{staticClass:"video-container"},[n("div",[n("ul",e._l(e.handleList,(function(t){return n("li",{key:t.type},["color"===t.type?n("el-color-picker",{attrs:{"show-alpha":"",disabled:!e.isToPeer},on:{change:e.colorChange},model:{value:e.color,callback:function(t){e.color=t},expression:"color"}}):e._e(),["color","lineWidth","polygon"].includes(t.type)?e._e():n("button",{class:{active:e.currHandle===t.type},attrs:{disabled:"cancel"===t.type?!e.isToPeer||e.allowCancel:"go"===t.type?!e.isToPeer||e.allowGo:!e.isToPeer},on:{click:function(n){return e.handleClick(t)}}},[e._v("\n                        "+e._s(t.name)+"\n                    ")]),"polygon"===t.type?n("el-popover",{attrs:{placement:"top",width:"400",trigger:"click"}},[n("el-input-number",{attrs:{"controls-position":"right",min:3,max:10},on:{change:e.sidesChange},model:{value:e.sides,callback:function(t){e.sides=t},expression:"sides"}}),n("button",{class:{active:e.currHandle===t.type},attrs:{slot:"reference",disabled:!e.isToPeer},on:{click:function(n){return e.handleClick(t)}},slot:"reference"},[e._v(e._s(t.name)+"\n                        ")])],1):e._e(),"lineWidth"===t.type?n("el-popover",{attrs:{placement:"top",width:"400",trigger:"click"}},[n("el-slider",{attrs:{max:20},on:{change:e.lineWidthChange},model:{value:e.lineWidth,callback:function(t){e.lineWidth=t},expression:"lineWidth"}}),n("button",{attrs:{slot:"reference",disabled:!e.isToPeer},slot:"reference"},[e._v(e._s(t.name)+" "),n("i",[e._v(e._s(e.lineWidth+"px"))])])],1):e._e()],1)})),0),n("div",[n("h5",[e._v("画板")]),n("canvas",{ref:"canvas",attrs:{width:"400",height:"300"}})])]),n("div",[n("h5",[e._v("聊天")]),n("div",{staticClass:"chat"},e._l(e.messageList,(function(t,a){return n("div",{key:a,staticClass:"message"},[n("p",[e._v("\n                        "+e._s(t.account)+" - "+e._s(t.time)+"\n                    ")]),n("p",{staticClass:"mes"},[e._v(e._s(t.mes))])])})),0),n("textarea",{directives:[{name:"model",rawName:"v-model",value:e.sendText,expression:"sendText"}],domProps:{value:e.sendText},on:{input:function(t){t.target.composing||(e.sendText=t.target.value)}}}),n("br"),n("button",{attrs:{disabled:!e.isToPeer},on:{click:function(t){return e.send(["text"])}}},[e._v("发送")])])])])},r=[],i=n("232a"),o=n("b382"),c=(n("6a61"),n("327b")),s=(n("ed63"),n("8cf2"),n("2b45"),n("29b2")),l=n("ebd6"),u={name:"palette",data:function(){return{account:window.sessionStorage.account||"",isJoin:!1,userList:[],roomid:"palette",isCall:!1,loading:!1,loadingText:"呼叫中",isToPeer:!1,peer:null,offerOption:{offerToReceiveAudio:1,offerToReceiveVideo:1},handleList:[{name:"圆",type:"arc"},{name:"线条",type:"line"},{name:"矩形",type:"rect"},{name:"多边形",type:"polygon"},{name:"橡皮擦",type:"eraser"},{name:"撤回",type:"cancel"},{name:"前进",type:"go"},{name:"清屏",type:"clear"},{name:"线宽",type:"lineWidth"},{name:"颜色",type:"color"}],color:"rgba(19, 206, 102, 1)",currHandle:"line",lineWidth:5,palette:null,allowCancel:!0,allowGo:!0,sides:3,channel:null,messageList:[],sendText:""}},methods:{formatTime:function(e){var t=e.getHours(),n=e.getMinutes(),a=e.getSeconds();return[t,n,a].map(this.formatNumber).join(":")},formatNumber:function(e){return e=e.toString(),e[1]?e:"0"+e},send:function(e){if("text"===e[0]){var t={account:this.account,time:this.formatTime(new Date),mes:this.sendText,type:"text"};this.channel.send(JSON.stringify(t)),this.messageList.push(t),this.sendText=""}else console.log("send",e),this.channel.send(JSON.stringify(e))},initPalette:function(){this.palette=new l["a"](this.$refs["canvas"],{drawColor:this.color,drawType:this.currHandle,lineWidth:this.lineWidth,allowCallback:this.allowCallback,moveCallback:this.moveCallback})},moveCallback:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.send(t)},allowCallback:function(e,t){this.allowCancel=!e,this.allowGo=!t},sidesChange:function(){this.palette.changeWay({sides:this.sides})},colorChange:function(){this.palette.changeWay({color:this.color})},lineWidthChange:function(){this.palette.changeWay({lineWidth:this.lineWidth})},handleClick:function(e){if(["cancel","go","clear"].includes(e.type))return this.moveCallback(e.type),void this.palette[e.type]();this.palette.changeWay({type:e.type}),["color","lineWidth"].includes(e.type)||(this.currHandle=e.type)},join:function(){this.account&&(this.isJoin=!0,window.sessionStorage.account=this.account,s["a"].emit("join",{roomid:this.roomid,account:this.account}))},initSocket:function(){var e=this;s["a"].on("joined",(function(t){e.userList=t})),s["a"].on("reply",function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.loading=!1,t.t0=n.type,t.next="1"===t.t0?4:"2"===t.t0?11:"3"===t.t0?13:15;break;case 4:return e.isCall=n.self,t.next=7,e.createP2P(n);case 7:return t.next=9,e.createDataChannel();case 9:return e.createOffer(n),t.abrupt("break",15);case 11:return e.$message({message:"对方拒绝了你的请求！",type:"warning"}),t.abrupt("break",15);case 13:return e.$message({message:"对方正在通话中！",type:"warning"}),t.abrupt("break",15);case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),s["a"].on("apply",(function(t){e.isCall?e.reply(t.self,"3"):e.$confirm(t.self+" 向你请求视频通话, 是否同意?","提示",{confirmButtonText:"同意",cancelButtonText:"拒绝",type:"warning"}).then(Object(c["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.createP2P(t);case 2:return n.next=4,e.onDataChannel();case 4:e.isCall=t.self,e.reply(t.self,"1");case 6:case"end":return n.stop()}}),n)})))).catch((function(){e.reply(t.self,"2")}))})),s["a"].on("1v1answer",(function(t){e.onAnswer(t)})),s["a"].on("1v1ICE",(function(t){e.onIce(t)})),s["a"].on("1v1offer",(function(t){e.onOffer(t)})),s["a"].on("1v1hangup",(function(t){e.clearState(),e.$message({message:"对方已断开连接！",type:"warning"})}))},hangup:function(){s["a"].emit("1v1hangup",{account:this.isCall,self:this.account}),this.clearState()},clearState:function(){this.peer.close(),this.channel.close(),this.palette.destroy(),this.peer=null,this.palette=null,this.channel=null,this.isToPeer=!1,this.isCall=!1},apply:function(e){this.loading=!0,this.loadingText="呼叫中",s["a"].emit("apply",{account:e,self:this.account})},reply:function(e,t){s["a"].emit("reply",{account:e,self:this.account,type:t})},createP2P:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.loading=!0,this.loadingText="正在建立通话连接",e.next=4,this.initPeer(t);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),createDataChannel:function(){try{this.channel=this.peer.createDataChannel("messagechannel"),this.handleChannel(this.channel)}catch(e){console.log("createDataChannel:",e)}},onDataChannel:function(){var e=this;this.peer.ondatachannel=function(t){e.channel=t.channel,e.handleChannel(e.channel)}},handleChannel:function(e){var t=this;e.binaryType="arraybuffer",e.onopen=function(e){console.log("channel onopen",e),t.isToPeer=!0,t.loading=!1,t.initPalette()},e.onclose=function(e){console.log("channel onclose",e)},e.onmessage=function(e){if(Array.isArray(JSON.parse(e.data))){var n,a=JSON.parse(e.data),r=Object(o["a"])(a),c=r[0],s=r.slice(1);(n=t.palette)[c].apply(n,Object(i["a"])(s))}else t.messageList.push(JSON.parse(e.data))}},initPeer:function(e){var t=this,n=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;this.peer=new n,this.peer.onicecandidate=function(n){n.candidate&&s["a"].emit("1v1ICE",{account:e.self,self:t.account,sdp:n.candidate})}},createOffer:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.peer.createOffer(this.offerOption);case 3:return n=e.sent,e.next=6,this.peer.setLocalDescription(n);case 6:s["a"].emit("1v1offer",{account:t.self,self:this.account,sdp:n}),e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](0),console.log("createOffer: ",e.t0);case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));function t(t){return e.apply(this,arguments)}return t}(),onOffer:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.peer.setRemoteDescription(t.sdp);case 3:return e.next=5,this.peer.createAnswer();case 5:return n=e.sent,e.next=8,this.peer.setLocalDescription(n);case 8:s["a"].emit("1v1answer",{account:t.self,self:this.account,sdp:n}),e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](0),console.log("onOffer: ",e.t0);case 14:case"end":return e.stop()}}),e,this,[[0,11]])})));function t(t){return e.apply(this,arguments)}return t}(),onAnswer:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.peer.setRemoteDescription(t.sdp);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e["catch"](0),console.log("onAnswer: ",e.t0);case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));function t(t){return e.apply(this,arguments)}return t}(),onIce:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.peer.addIceCandidate(t.sdp);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e["catch"](0),console.log("onAnswer: ",e.t0);case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));function t(t){return e.apply(this,arguments)}return t}()},mounted:function(){this.initSocket(),this.account&&this.join()}},p=u,f=(n("f92a"),n("2c07")),h=Object(f["a"])(p,a,r,!1,null,"6a2b9b3d",null);t["default"]=h.exports},b382:function(e,t,n){"use strict";function a(e){if(Array.isArray(e))return e}n.d(t,"a",(function(){return c}));var r=n("b5eb"),i=n("db29");function o(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e){return a(e)||Object(r["a"])(e)||Object(i["a"])(e)||o()}},b5eb:function(e,t,n){"use strict";function a(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}n.d(t,"a",(function(){return a}))},db29:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n("df3b");function r(e,t){if(e){if("string"===typeof e)return Object(a["a"])(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Object(a["a"])(e,t):void 0}}},df3b:function(e,t,n){"use strict";function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}n.d(t,"a",(function(){return a}))},f1fe:function(e,t,n){"use strict";var a=n("69b3");e.exports=function(){var e=a(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},f92a:function(e,t,n){"use strict";n("0bd5")}}]);